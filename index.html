<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Visual History Player</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Material Icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  
  <!-- Google Font: Poppins -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Color Thief Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/color-thief/2.3.0/color-thief.umd.js"></script>

  <!-- Custom Config & Styles -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Poppins', 'sans-serif'],
          },
          colors: {
            glass: 'rgba(255, 255, 255, 0.08)',
            glassHover: 'rgba(255, 255, 255, 0.15)',
            spotify: '#1DB954',
          },
          animation: {
            'spin-slow': 'spin 12s linear infinite',
            'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
            'fade-in': 'fadeIn 0.5s ease-out forwards',
            'slide-up': 'slideUp 0.5s ease-out forwards',
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: '0' },
              '100%': { opacity: '1' },
            },
            slideUp: {
              '0%': { opacity: '0', transform: 'translateY(20px)' },
              '100%': { opacity: '1', transform: 'translateY(0)' },
            }
          }
        }
      }
    }
  </script>

  <style>
    /* Custom Scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
    }
    ::-webkit-scrollbar-track {
      background: transparent; 
    }
    ::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.2); 
      border-radius: 10px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 255, 255, 0.4); 
    }

    /* Hide default select arrow */
    select {
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
    }
    
    /* Smooth image transitions */
    #bg-image {
      transition: background-image 1s ease-in-out;
    }
    
    .glass-panel {
      background: rgba(20, 20, 20, 0.6);
      backdrop-filter: blur(40px);
      -webkit-backdrop-filter: blur(40px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
    }
  </style>
</head>
<body class="bg-black text-white h-screen w-full overflow-hidden flex items-center justify-center relative selection:bg-spotify selection:text-white">

  <!-- Dynamic Background Layer -->
  <div id="bg-image" class="absolute inset-0 bg-cover bg-center z-0 opacity-40 scale-110"></div>
  <div class="absolute inset-0 bg-gradient-to-t from-[#050505] via-[#050505]/80 to-transparent z-0"></div>

  <!-- Main Container -->
  <div class="relative z-10 w-full h-full max-w-7xl mx-auto p-4 md:p-8 flex flex-col md:flex-row gap-6">
    
    <!-- Left Panel: Now Playing / Hero -->
    <div class="w-full md:w-5/12 lg:w-4/12 flex flex-col justify-center items-center glass-panel rounded-3xl p-8 animate-slide-up">
      
      <!-- Album Art -->
      <div class="relative group w-64 h-64 md:w-80 md:h-80 mb-8">
        <div class="absolute inset-0 bg-white/20 rounded-full blur-2xl opacity-0 group-hover:opacity-30 transition-opacity duration-500"></div>
        <img id="album-art" src="https://via.placeholder.com/300" alt="Album Art" class="w-full h-full object-cover rounded-2xl shadow-2xl shadow-black/50 transform transition-transform duration-500 group-hover:scale-[1.02]" crossorigin="anonymous">
      </div>

      <!-- Track Info -->
      <div class="text-center w-full space-y-2 mb-6">
        <h1 id="track-title" class="text-2xl md:text-3xl font-bold tracking-tight truncate px-2 drop-shadow-lg">Track Title</h1>
        <h3 id="track-artist" class="text-lg text-gray-300 font-medium truncate px-2">Artist Name</h3>
      </div>

      <!-- Progress Bar -->
      <div class="w-full max-w-xs mb-8 group">
        <div class="h-1.5 w-full bg-white/10 rounded-full overflow-hidden">
          <div class="progress h-full bg-spotify w-0 shadow-[0_0_10px_rgba(29,185,84,0.7)] transition-all duration-[3000ms] ease-linear"></div>
        </div>
      </div>

      <!-- Controls (Visual Only) -->
      <div class="flex items-center gap-8">
        <button id="prev-btn" class="text-gray-400 hover:text-white transition-colors transform hover:scale-110">
          <span class="material-icons text-4xl">skip_previous</span>
        </button>
        <button id="play-btn" class="w-16 h-16 rounded-full bg-white text-black flex items-center justify-center hover:scale-105 hover:bg-spotify hover:text-white transition-all duration-300 shadow-lg shadow-white/10">
          <span class="material-icons text-4xl ml-1">play_arrow</span>
        </button>
        <button id="next-btn" class="text-gray-400 hover:text-white transition-colors transform hover:scale-110">
          <span class="material-icons text-4xl">skip_next</span>
        </button>
      </div>
    </div>

    <!-- Right Panel: Stats & History -->
    <div class="w-full md:w-7/12 lg:w-8/12 glass-panel rounded-3xl flex flex-col overflow-hidden animate-slide-up" style="animation-delay: 0.1s;">
      
      <!-- Navigation Tabs -->
      <div class="flex items-center justify-between px-6 py-4 border-b border-white/10 bg-black/20">
        <div class="flex gap-1 md:gap-2 overflow-x-auto no-scrollbar">
          <button id="tab-recent-btn" class="tab-btn active px-4 py-2 rounded-full text-sm font-medium transition-all duration-300 flex items-center gap-2 bg-white/10 text-white border border-white/5">
            <span class="material-icons text-lg">history</span> <span class="hidden sm:inline">Recent</span>
          </button>
          <button id="tab-albums-btn" class="tab-btn px-4 py-2 rounded-full text-sm font-medium text-gray-400 hover:text-white hover:bg-white/5 transition-all duration-300 flex items-center gap-2 border border-transparent">
            <span class="material-icons text-lg">album</span> <span class="hidden sm:inline">Albums</span>
          </button>
          <button id="tab-artists-btn" class="tab-btn px-4 py-2 rounded-full text-sm font-medium text-gray-400 hover:text-white hover:bg-white/5 transition-all duration-300 flex items-center gap-2 border border-transparent">
            <span class="material-icons text-lg">person</span> <span class="hidden sm:inline">Artists</span>
          </button>
          <button id="tab-songs-btn" class="tab-btn px-4 py-2 rounded-full text-sm font-medium text-gray-400 hover:text-white hover:bg-white/5 transition-all duration-300 flex items-center gap-2 border border-transparent">
            <span class="material-icons text-lg">music_note</span> <span class="hidden sm:inline">Songs</span>
          </button>
        </div>
      </div>

      <!-- Content Area -->
      <div class="flex-1 overflow-y-auto p-4 md:p-6 relative">
        
        <!-- Tab: Recently Played -->
        <div id="tab-recent" class="tab-content block animate-fade-in">
          <header class="flex justify-between items-end mb-6">
            <h2 class="text-2xl font-bold">Recently Played</h2>
            <span class="text-xs text-gray-500 uppercase tracking-wider font-semibold">Live History</span>
          </header>
          <ul id="recent-tracks-list" class="space-y-2">
            <!-- JS Injected -->
            <li class="text-gray-500 animate-pulse">Loading history...</li>
          </ul>
        </div>

        <!-- Tab: Top Albums -->
        <div id="tab-albums" class="tab-content hidden animate-fade-in">
          <header class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold">Top Albums</h2>
            <div class="relative">
              <select id="top-albums-interval" class="bg-white/10 text-white text-sm rounded-lg px-3 py-1.5 pr-8 focus:outline-none focus:ring-1 focus:ring-spotify cursor-pointer hover:bg-white/20 transition-colors">
                <option value="overall" class="bg-gray-900">All Time</option>
                <option value="7day" class="bg-gray-900">7 Days</option>
                <option value="1month" selected class="bg-gray-900">1 Month</option>
                <option value="12month" class="bg-gray-900">1 Year</option>
              </select>
              <span class="material-icons absolute right-2 top-1.5 text-sm pointer-events-none text-gray-400">expand_more</span>
            </div>
          </header>
          <ul id="top-albums-list" class="space-y-2">
            <li class="text-gray-500 animate-pulse">Loading albums...</li>
          </ul>
          <!-- Pagination -->
          <div class="flex justify-end items-center gap-4 mt-6 pt-4 border-t border-white/10">
            <button id="top-albums-prev" class="w-8 h-8 rounded-full bg-white/5 hover:bg-spotify hover:text-white flex items-center justify-center transition-colors"><span class="material-icons text-lg">chevron_left</span></button>
            <span id="top-albums-page-number" class="text-sm font-mono text-gray-400">1</span>
            <button id="top-albums-next" class="w-8 h-8 rounded-full bg-white/5 hover:bg-spotify hover:text-white flex items-center justify-center transition-colors"><span class="material-icons text-lg">chevron_right</span></button>
          </div>
        </div>

        <!-- Tab: Top Artists -->
        <div id="tab-artists" class="tab-content hidden animate-fade-in">
          <header class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold">Top Artists</h2>
            <div class="relative">
              <select id="top-artists-interval" class="bg-white/10 text-white text-sm rounded-lg px-3 py-1.5 pr-8 focus:outline-none focus:ring-1 focus:ring-spotify cursor-pointer hover:bg-white/20 transition-colors">
                <option value="overall" class="bg-gray-900">All Time</option>
                <option value="7day" class="bg-gray-900">7 Days</option>
                <option value="1month" selected class="bg-gray-900">1 Month</option>
                <option value="12month" class="bg-gray-900">1 Year</option>
              </select>
              <span class="material-icons absolute right-2 top-1.5 text-sm pointer-events-none text-gray-400">expand_more</span>
            </div>
          </header>
          <ul id="top-artists-list" class="space-y-2">
            <li class="text-gray-500 animate-pulse">Loading artists...</li>
          </ul>
          <div class="flex justify-end items-center gap-4 mt-6 pt-4 border-t border-white/10">
            <button id="top-artists-prev" class="w-8 h-8 rounded-full bg-white/5 hover:bg-spotify hover:text-white flex items-center justify-center transition-colors"><span class="material-icons text-lg">chevron_left</span></button>
            <span id="top-artists-page-number" class="text-sm font-mono text-gray-400">1</span>
            <button id="top-artists-next" class="w-8 h-8 rounded-full bg-white/5 hover:bg-spotify hover:text-white flex items-center justify-center transition-colors"><span class="material-icons text-lg">chevron_right</span></button>
          </div>
        </div>

        <!-- Tab: Top Songs -->
        <div id="tab-songs" class="tab-content hidden animate-fade-in">
          <header class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold">Top Songs</h2>
            <div class="relative">
              <select id="top-songs-interval" class="bg-white/10 text-white text-sm rounded-lg px-3 py-1.5 pr-8 focus:outline-none focus:ring-1 focus:ring-spotify cursor-pointer hover:bg-white/20 transition-colors">
                <option value="overall" class="bg-gray-900">All Time</option>
                <option value="7day" class="bg-gray-900">7 Days</option>
                <option value="1month" selected class="bg-gray-900">1 Month</option>
                <option value="12month" class="bg-gray-900">1 Year</option>
              </select>
              <span class="material-icons absolute right-2 top-1.5 text-sm pointer-events-none text-gray-400">expand_more</span>
            </div>
          </header>
          <ul id="top-songs-list" class="space-y-2">
            <li class="text-gray-500 animate-pulse">Loading songs...</li>
          </ul>
          <div class="flex justify-end items-center gap-4 mt-6 pt-4 border-t border-white/10">
            <button id="top-songs-prev" class="w-8 h-8 rounded-full bg-white/5 hover:bg-spotify hover:text-white flex items-center justify-center transition-colors"><span class="material-icons text-lg">chevron_left</span></button>
            <span id="top-songs-page-number" class="text-sm font-mono text-gray-400">1</span>
            <button id="top-songs-next" class="w-8 h-8 rounded-full bg-white/5 hover:bg-spotify hover:text-white flex items-center justify-center transition-colors"><span class="material-icons text-lg">chevron_right</span></button>
          </div>
        </div>

      </div>
    </div>
  </div>

  <script>
    // --- CONFIGURATION ---
    // Replace with your actual Last.fm API key
    const API_KEY = 'YOUR_LASTFM_API_KEY_HERE'; 
    const USERNAME = 'Isaiart';
    
    const colorThief = new ColorThief();
    let currentTrack = null;
    let progressInterval;
    
    // Pagination state
    let topSongsPage = 1, topArtistsPage = 1, topAlbumsPage = 1;
    
    // --- API HELPER ---
    async function fetchLastfmData(method, params = {}) {
      const queryParams = new URLSearchParams({
        method,
        user: USERNAME,
        api_key: API_KEY,
        format: 'json',
        ...params
      });
      const url = `https://ws.audioscrobbler.com/2.0/?${queryParams}`;
      try {
        const response = await fetch(url);
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        return await response.json();
      } catch (error) {
        console.error(`Error fetching ${method}:`, error);
        return null;
      }
    }
    
    // --- UTILS ---
    function getAlbumArtUrl(images, size = 'extralarge') {
      if (!images) return 'https://via.placeholder.com/300?text=No+Image';
      const image = images.find(img => img.size === size);
      if (image && image['#text']) {
        return image['#text'];
      } else {
        // Fallback to largest available if requested size missing
        return images[images.length - 1]['#text'] || 'https://via.placeholder.com/300?text=No+Image';
      }
    }
    
    function setBackgroundImage(url) {
      const bg = document.getElementById('bg-image');
      bg.style.backgroundImage = `url(${url})`;
    }
    
    function formatPlayTime(timestamp) {
      if (!timestamp) return 'Unknown';
      const now = new Date();
      const playedAt = new Date(timestamp * 1000);
      const diff = now - playedAt;
      const minutes = Math.floor(diff / 60000);
      if (minutes < 1) return 'Just now';
      if (minutes === 1) return '1 min ago';
      if (minutes < 60) return `${minutes} mins ago`;
      const hours = Math.floor(minutes / 60);
      if (hours === 1) return '1 hr ago';
      if (hours < 24) return `${hours} hrs ago`;
      const days = Math.floor(hours / 24);
      if (days === 1) return '1 day ago';
      return `${days} days ago`;
    }
    
    // --- UI UPDATES ---

    function updateNowPlaying(track) {
      const albumArtUrl = getAlbumArtUrl(track.image, 'extralarge');
      const imgElement = document.getElementById('album-art');
      
      // Only update DOM if src changes to prevent flickering
      if (imgElement.src !== albumArtUrl) {
        imgElement.src = albumArtUrl;
        setBackgroundImage(albumArtUrl);
      }
      
      document.getElementById('track-title').textContent = track.name;
      document.getElementById('track-artist').textContent = track.artist['#text'];
    }
    
    // Template for Track List Item (Tailwind styled)
    function createTrackListItem(track, extraInfo = '', isNowPlaying = false) {
      const albumArtUrl = getAlbumArtUrl(track.image, 'medium'); // Use medium for list
      const playTime = isNowPlaying ? '<span class="text-spotify font-bold animate-pulse">Now Playing</span>' : (track.date ? formatPlayTime(track.date.uts) : '');
      
      return `
        <li class="group flex items-center p-3 rounded-xl hover:bg-white/10 transition-all duration-300 cursor-default border border-transparent hover:border-white/5">
          <img src="${albumArtUrl}" alt="Art" class="w-12 h-12 rounded-lg object-cover shadow-md mr-4 group-hover:scale-105 transition-transform">
          <div class="flex-1 min-w-0">
            <div class="font-semibold text-white truncate text-sm md:text-base">${track.name}</div>
            <div class="text-xs md:text-sm text-gray-400 truncate group-hover:text-gray-300">${track.artist['#text'] || track.artist.name}</div>
          </div>
          <div class="text-xs text-gray-500 font-medium ml-2 text-right whitespace-nowrap">
            ${extraInfo ? `<span class="block text-gray-400">${extraInfo}</span>` : ''}
            ${playTime}
          </div>
        </li>
      `;
    }
    
    // Template for Artist List Item
    function createArtistListItem(artist, rank) {
      // Last.fm artist images are often missing in API, using placeholder or generic icon if needed
      const imageUrl = artist.image ? getAlbumArtUrl(artist.image, 'medium') : 'https://via.placeholder.com/64?text=Artist';
      
      return `
        <li class="group flex items-center p-3 rounded-xl hover:bg-white/10 transition-all duration-300 cursor-default border border-transparent hover:border-white/5">
          <div class="w-8 text-center text-gray-500 font-bold mr-2 text-sm">#${rank}</div>
          <div class="flex-1 min-w-0">
            <div class="font-bold text-white truncate text-base">${artist.name}</div>
            <div class="text-xs text-spotify font-medium">${parseInt(artist.playcount).toLocaleString()} plays</div>
          </div>
          <a href="${artist.url}" target="_blank" class="opacity-0 group-hover:opacity-100 transition-opacity text-gray-400 hover:text-white">
            <span class="material-icons text-lg">open_in_new</span>
          </a>
        </li>
      `;
    }
    
    // Template for Album List Item
    function createAlbumListItem(album, rank) {
      const albumArtUrl = album.image ? getAlbumArtUrl(album.image, 'medium') : 'https://via.placeholder.com/64?text=Album';
      
      return `
        <li class="group flex items-center p-3 rounded-xl hover:bg-white/10 transition-all duration-300 cursor-default border border-transparent hover:border-white/5">
          <div class="w-6 text-center text-gray-500 font-bold mr-2 text-xs">#${rank}</div>
          <img src="${albumArtUrl}" alt="Art" class="w-12 h-12 rounded-lg object-cover shadow-md mr-4 group-hover:scale-105 transition-transform">
          <div class="flex-1 min-w-0">
            <div class="font-semibold text-white truncate text-sm md:text-base">${album.name}</div>
            <div class="text-xs text-gray-400 truncate">${album.artist.name}</div>
          </div>
          <div class="text-xs text-gray-500 font-medium ml-2">
            ${parseInt(album.playcount).toLocaleString()} plays
          </div>
        </li>
      `;
    }
    
    function startProgressBar() {
      const progress = document.querySelector('.progress');
      let width = 0;
      clearInterval(progressInterval);
      progress.style.width = '0%';
      // Fake progress bar simulation
      progressInterval = setInterval(() => {
        if (width >= 100) {
            width = 0; // Loop it for visual effect since we don't have real duration
        } else {
          width += 0.5;
          progress.style.width = width + '%';
        }
      }, 1000); 
    }
    
    // --- DATA FETCHING FUNCTIONS ---

    async function displayNowPlaying() {
      const data = await fetchLastfmData('user.getrecenttracks', { limit: 1 });
      if (data && data.recenttracks && data.recenttracks.track && data.recenttracks.track[0]) {
        const track = data.recenttracks.track[0];
        // Check if track changed to avoid unnecessary DOM updates
        if (!currentTrack || track.name !== currentTrack.name) {
          currentTrack = track;
          updateNowPlaying(track);
          startProgressBar();
        }
      }
    }
    
    async function displayRecentTracks() {
      const data = await fetchLastfmData('user.getrecenttracks', { limit: 15 });
      const list = document.getElementById('recent-tracks-list');
      if (data && data.recenttracks && data.recenttracks.track) {
        const tracks = data.recenttracks.track;
        // Map tracks to HTML. Note: The first track might be "now playing"
        list.innerHTML = tracks.map(track => {
            const isNowPlaying = track['@attr'] && track['@attr'].nowplaying === 'true';
            return createTrackListItem(track, '', isNowPlaying);
        }).join('');
      } else {
        list.innerHTML = '<li class="p-4 text-center text-gray-500">Could not load tracks.</li>';
      }
    }
    
    async function displayTopSongs() {
      const interval = document.getElementById('top-songs-interval').value;
      const data = await fetchLastfmData('user.gettoptracks', { period: interval, limit: 10, page: topSongsPage });
      const list = document.getElementById('top-songs-list');
      if (data && data.toptracks && data.toptracks.track) {
        list.innerHTML = data.toptracks.track.map(track => 
            createTrackListItem(track, `${parseInt(track.playcount).toLocaleString()} plays`)
        ).join('');
      } else {
        list.innerHTML = '<li class="p-4 text-center text-gray-500">No data available.</li>';
      }
      document.getElementById('top-songs-page-number').textContent = topSongsPage;
    }
    
    async function displayTopArtists() {
      const interval = document.getElementById('top-artists-interval').value;
      const data = await fetchLastfmData('user.gettopartists', { period: interval, limit: 10, page: topArtistsPage });
      const list = document.getElementById('top-artists-list');
      if (data && data.topartists && data.topartists.artist) {
        list.innerHTML = data.topartists.artist.map((artist, index) => 
            createArtistListItem(artist, (topArtistsPage - 1) * 10 + index + 1)
        ).join('');
      } else {
        list.innerHTML = '<li class="p-4 text-center text-gray-500">No data available.</li>';
      }
      document.getElementById('top-artists-page-number').textContent = topArtistsPage;
    }
    
    async function displayTopAlbums() {
      const interval = document.getElementById('top-albums-interval').value;
      const data = await fetchLastfmData('user.gettopalbums', { period: interval, limit: 10, page: topAlbumsPage });
      const list = document.getElementById('top-albums-list');
      if (data && data.topalbums && data.topalbums.album) {
        list.innerHTML = data.topalbums.album.map((album, index) => 
            createAlbumListItem(album, (topAlbumsPage - 1) * 10 + index + 1)
        ).join('');
      } else {
        list.innerHTML = '<li class="p-4 text-center text-gray-500">No data available.</li>';
      }
      document.getElementById('top-albums-page-number').textContent = topAlbumsPage;
    }
    
    function updatePage() {
      displayNowPlaying();
      // Only update the active tab to save API calls
      const activeTabId = document.querySelector('.tab-content.block').id;
      if (activeTabId === 'tab-recent') displayRecentTracks();
      else if (activeTabId === 'tab-albums') displayTopAlbums();
      else if (activeTabId === 'tab-artists') displayTopArtists();
      else if (activeTabId === 'tab-songs') displayTopSongs();
    }
    
    // --- EVENT LISTENERS ---
    
    // Interval Selectors
    document.getElementById('top-songs-interval').addEventListener('change', () => { topSongsPage = 1; displayTopSongs(); });
    document.getElementById('top-artists-interval').addEventListener('change', () => { topArtistsPage = 1; displayTopArtists(); });
    document.getElementById('top-albums-interval').addEventListener('change', () => { topAlbumsPage = 1; displayTopAlbums(); });
    
    // Pagination
    document.getElementById('top-songs-prev').addEventListener('click', () => { if(topSongsPage > 1) { topSongsPage--; displayTopSongs(); }});
    document.getElementById('top-songs-next').addEventListener('click', () => { topSongsPage++; displayTopSongs(); });
    
    document.getElementById('top-artists-prev').addEventListener('click', () => { if(topArtistsPage > 1) { topArtistsPage--; displayTopArtists(); }});
    document.getElementById('top-artists-next').addEventListener('click', () => { topArtistsPage++; displayTopArtists(); });
    
    document.getElementById('top-albums-prev').addEventListener('click', () => { if(topAlbumsPage > 1) { topAlbumsPage--; displayTopAlbums(); }});
    document.getElementById('top-albums-next').addEventListener('click', () => { topAlbumsPage++; displayTopAlbums(); });
    
    // Tab Navigation Logic
    const tabs = {
      recent: document.getElementById('tab-recent'),
      albums: document.getElementById('tab-albums'),
      artists: document.getElementById('tab-artists'),
      songs: document.getElementById('tab-songs')
    };
    const tabButtons = {
      recent: document.getElementById('tab-recent-btn'),
      albums: document.getElementById('tab-albums-btn'),
      artists: document.getElementById('tab-artists-btn'),
      songs: document.getElementById('tab-songs-btn')
    };
    
    function switchTab(tabName) {
      // Reset all tabs
      Object.values(tabs).forEach(tab => {
        tab.classList.remove('block', 'animate-fade-in');
        tab.classList.add('hidden');
      });
      
      // Reset all buttons
      Object.values(tabButtons).forEach(btn => {
        btn.classList.remove('bg-white/10', 'text-white', 'border-white/5');
        btn.classList.add('text-gray-400', 'border-transparent');
      });
      
      // Activate selected
      tabs[tabName].classList.remove('hidden');
      tabs[tabName].classList.add('block', 'animate-fade-in');
      
      tabButtons[tabName].classList.remove('text-gray-400', 'border-transparent');
      tabButtons[tabName].classList.add('bg-white/10', 'text-white', 'border-white/5');
      
      // Trigger data fetch for the new tab
      if(tabName === 'recent') displayRecentTracks();
      if(tabName === 'albums') displayTopAlbums();
      if(tabName === 'artists') displayTopArtists();
      if(tabName === 'songs') displayTopSongs();
    }
    
    tabButtons.recent.addEventListener('click', () => switchTab('recent'));
    tabButtons.albums.addEventListener('click', () => switchTab('albums'));
    tabButtons.artists.addEventListener('click', () => switchTab('artists'));
    tabButtons.songs.addEventListener('click', () => switchTab('songs'));
    
    // --- INITIALIZATION ---
    // Initial load
    displayNowPlaying();
    displayRecentTracks();
    
    // Auto-refresh every 10 seconds
    setInterval(updatePage, 10000);
  </script>
</body>
</html>