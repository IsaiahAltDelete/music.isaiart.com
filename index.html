<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Visual History Player</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Material Icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  
  <!-- Google Font: Poppins -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Tailwind Config -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Poppins', 'sans-serif'],
          },
          colors: {
            spotify: '#1DB954',
            glass: 'rgba(20, 20, 20, 0.6)',
            dark: '#121212',
          },
          animation: {
            'spin-slow': 'spin 8s linear infinite',
            'fade-in': 'fadeIn 0.5s ease-out forwards',
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: '0', transform: 'translateY(10px)' },
              '100%': { opacity: '1', transform: 'translateY(0)' },
            }
          }
        }
      }
    }
  </script>

  <style>
    /* Custom Scrollbar */
    ::-webkit-scrollbar {
      width: 4px;
    }
    ::-webkit-scrollbar-track {
      background: transparent; 
    }
    ::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.2); 
      border-radius: 10px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 255, 255, 0.4); 
    }

    select {
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
    }
    
    #bg-image {
      transition: background-image 1s ease-in-out;
    }

    .glass-panel {
      background: rgba(18, 18, 18, 0.75);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
    }

    .no-scrollbar::-webkit-scrollbar {
      display: none;
    }
    .no-scrollbar {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
  </style>
</head>
<body class="bg-black text-white h-[100dvh] w-screen overflow-hidden flex items-center justify-center relative selection:bg-spotify selection:text-white">

  <!-- Dynamic Background Layer -->
  <div id="bg-image" class="absolute inset-0 bg-cover bg-center z-0 opacity-50 scale-110 blur-[60px]"></div>
  <div class="absolute inset-0 bg-black/40 z-0"></div>

  <!-- Main Layout Container -->
  <div class="relative z-10 w-full h-full max-w-7xl mx-auto p-4 md:p-8 flex flex-col md:flex-row gap-4 md:gap-6 overflow-hidden">
    
    <!-- LEFT PANEL: Now Playing -->
    <div class="w-full md:w-5/12 lg:w-4/12 flex-shrink-0 flex flex-col justify-center items-center glass-panel rounded-3xl p-6 md:p-8 transition-all duration-500">
      
      <!-- Spinning Record Container -->
      <div class="relative group w-56 h-56 md:w-80 md:h-80 mb-6 md:mb-10 flex-shrink-0">
        <!-- Glow behind -->
        <div class="absolute inset-0 bg-white/10 rounded-full blur-2xl opacity-0 group-hover:opacity-40 transition-opacity duration-500"></div>
        
        <!-- The Record Image -->
        <img id="album-art" src="https://via.placeholder.com/300" alt="Album Art" class="w-full h-full object-cover rounded-full shadow-[0_0_30px_rgba(0,0,0,0.6)] animate-spin-slow group-hover:pause border-4 border-black/20" crossorigin="anonymous">
        
        <!-- Vinyl Center Hole -->
        <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
            <div class="w-4 h-4 md:w-6 md:h-6 bg-[#121212] rounded-full border border-gray-700 shadow-inner"></div>
        </div>
      </div>

      <!-- Track Info -->
      <div class="text-center w-full space-y-1 md:space-y-2 mb-4 md:mb-6">
        <h1 id="track-title" class="text-xl md:text-2xl font-bold tracking-tight truncate px-2 drop-shadow-md">Loading...</h1>
        <h3 id="track-artist" class="text-sm md:text-lg text-gray-300 font-medium truncate px-2">Please wait</h3>
      </div>

      <!-- Progress Bar -->
      <div class="w-full max-w-xs mb-4 md:mb-8 group">
        <div class="flex justify-between text-[10px] text-gray-400 mb-1 px-1">
          <span>0:00</span>
          <span>LIVE</span>
        </div>
        <div class="h-1.5 w-full bg-white/10 rounded-full overflow-hidden">
          <div class="progress h-full bg-spotify w-0 shadow-[0_0_10px_rgba(29,185,84,0.7)] transition-all duration-[1000ms] ease-linear"></div>
        </div>
      </div>

      <!-- Controls -->
      <div class="flex items-center gap-6 md:gap-8">
        <button class="text-gray-400 hover:text-white transition-colors transform hover:scale-110 active:scale-95">
          <span class="material-icons text-3xl md:text-4xl">skip_previous</span>
        </button>
        <button class="w-12 h-12 md:w-16 md:h-16 rounded-full bg-white text-black flex items-center justify-center hover:scale-105 hover:bg-spotify hover:text-white transition-all duration-300 shadow-lg shadow-white/10 active:scale-95">
          <span class="material-icons text-3xl md:text-4xl ml-1">play_arrow</span>
        </button>
        <button class="text-gray-400 hover:text-white transition-colors transform hover:scale-110 active:scale-95">
          <span class="material-icons text-3xl md:text-4xl">skip_next</span>
        </button>
      </div>
    </div>

    <!-- RIGHT PANEL: Stats & History -->
    <div class="w-full md:w-7/12 lg:w-8/12 glass-panel rounded-3xl flex flex-col overflow-hidden flex-grow h-full">
      
      <!-- Navigation Tabs -->
      <div class="flex-shrink-0 flex items-center justify-between px-4 py-3 md:px-6 md:py-4 border-b border-white/10 bg-black/20 z-30 relative">
        <div class="flex gap-2 overflow-x-auto no-scrollbar w-full">
          <button id="tab-recent-btn" onclick="switchTab('recent')" class="tab-btn active whitespace-nowrap px-3 py-1.5 md:px-4 md:py-2 rounded-full text-xs md:text-sm font-medium transition-all duration-300 flex items-center gap-2 bg-white/10 text-white border border-white/5">
            <span class="material-icons text-sm md:text-lg">history</span> Recent
          </button>
          <button id="tab-albums-btn" onclick="switchTab('albums')" class="tab-btn whitespace-nowrap px-3 py-1.5 md:px-4 md:py-2 rounded-full text-xs md:text-sm font-medium text-gray-400 hover:text-white hover:bg-white/5 transition-all duration-300 flex items-center gap-2 border border-transparent">
            <span class="material-icons text-sm md:text-lg">album</span> Albums
          </button>
          <button id="tab-artists-btn" onclick="switchTab('artists')" class="tab-btn whitespace-nowrap px-3 py-1.5 md:px-4 md:py-2 rounded-full text-xs md:text-sm font-medium text-gray-400 hover:text-white hover:bg-white/5 transition-all duration-300 flex items-center gap-2 border border-transparent">
            <span class="material-icons text-sm md:text-lg">person</span> Artists
          </button>
          <button id="tab-songs-btn" onclick="switchTab('songs')" class="tab-btn whitespace-nowrap px-3 py-1.5 md:px-4 md:py-2 rounded-full text-xs md:text-sm font-medium text-gray-400 hover:text-white hover:bg-white/5 transition-all duration-300 flex items-center gap-2 border border-transparent">
            <span class="material-icons text-sm md:text-lg">music_note</span> Songs
          </button>
        </div>
      </div>

      <!-- Content Area -->
      <!-- Removed padding from parent container to fix gap issue -->
      <div class="flex-1 overflow-y-auto relative scroll-smooth">
        
        <!-- Tab: Recently Played -->
        <div id="tab-recent" class="tab-content block animate-fade-in">
          <!-- Sticky Header: Added padding here instead of parent -->
          <header class="flex justify-between items-center sticky top-0 z-20 bg-[#121212]/90 backdrop-blur-xl px-4 md:px-6 py-4 mb-2 border-b border-white/5 shadow-lg transition-all">
            <h2 class="text-xl md:text-2xl font-bold drop-shadow-sm">Recently Played</h2>
            <span class="text-[10px] md:text-xs text-spotify uppercase tracking-wider font-bold bg-spotify/10 px-2 py-1 rounded border border-spotify/20">Live</span>
          </header>
          <!-- List: Added padding here -->
          <ul id="recent-tracks-list" class="space-y-2 px-4 md:px-6 pb-6 pt-2">
            <li class="text-gray-500 animate-pulse text-sm">Loading history...</li>
          </ul>
        </div>

        <!-- Tab: Top Albums -->
        <div id="tab-albums" class="tab-content hidden animate-fade-in">
          <header class="flex justify-between items-center sticky top-0 z-20 bg-[#121212]/90 backdrop-blur-xl px-4 md:px-6 py-4 mb-2 border-b border-white/5 shadow-lg transition-all">
            <h2 class="text-xl md:text-2xl font-bold">Top Albums</h2>
            <div class="relative">
              <select id="top-albums-interval" class="bg-black/40 text-white text-xs md:text-sm rounded-lg px-3 py-1.5 pr-8 focus:outline-none focus:ring-1 focus:ring-spotify cursor-pointer hover:bg-white/10 transition-colors border border-white/10">
                <option value="overall">All Time</option>
                <option value="7day">7 Days</option>
                <option value="1month" selected>1 Month</option>
                <option value="12month">1 Year</option>
              </select>
              <span class="material-icons absolute right-2 top-1.5 text-sm pointer-events-none text-gray-400">expand_more</span>
            </div>
          </header>
          <ul id="top-albums-list" class="space-y-2 px-4 md:px-6 pt-2">
            <li class="text-gray-500 animate-pulse text-sm">Loading albums...</li>
          </ul>
          <div class="flex justify-center md:justify-end items-center gap-4 mt-6 pt-4 border-t border-white/10 pb-6 px-4 md:px-6">
            <button id="top-albums-prev" class="w-8 h-8 rounded-full bg-white/5 hover:bg-spotify hover:text-white flex items-center justify-center transition-colors"><span class="material-icons text-lg">chevron_left</span></button>
            <span id="top-albums-page-number" class="text-sm font-mono text-gray-400">1</span>
            <button id="top-albums-next" class="w-8 h-8 rounded-full bg-white/5 hover:bg-spotify hover:text-white flex items-center justify-center transition-colors"><span class="material-icons text-lg">chevron_right</span></button>
          </div>
        </div>

        <!-- Tab: Top Artists -->
        <div id="tab-artists" class="tab-content hidden animate-fade-in">
          <header class="flex justify-between items-center sticky top-0 z-20 bg-[#121212]/90 backdrop-blur-xl px-4 md:px-6 py-4 mb-2 border-b border-white/5 shadow-lg transition-all">
            <h2 class="text-xl md:text-2xl font-bold">Top Artists</h2>
            <div class="relative">
              <select id="top-artists-interval" class="bg-black/40 text-white text-xs md:text-sm rounded-lg px-3 py-1.5 pr-8 focus:outline-none focus:ring-1 focus:ring-spotify cursor-pointer hover:bg-white/10 transition-colors border border-white/10">
                <option value="overall">All Time</option>
                <option value="7day">7 Days</option>
                <option value="1month" selected>1 Month</option>
                <option value="12month">1 Year</option>
              </select>
              <span class="material-icons absolute right-2 top-1.5 text-sm pointer-events-none text-gray-400">expand_more</span>
            </div>
          </header>
          <ul id="top-artists-list" class="space-y-2 px-4 md:px-6 pt-2">
            <li class="text-gray-500 animate-pulse text-sm">Loading artists...</li>
          </ul>
          <div class="flex justify-center md:justify-end items-center gap-4 mt-6 pt-4 border-t border-white/10 pb-6 px-4 md:px-6">
            <button id="top-artists-prev" class="w-8 h-8 rounded-full bg-white/5 hover:bg-spotify hover:text-white flex items-center justify-center transition-colors"><span class="material-icons text-lg">chevron_left</span></button>
            <span id="top-artists-page-number" class="text-sm font-mono text-gray-400">1</span>
            <button id="top-artists-next" class="w-8 h-8 rounded-full bg-white/5 hover:bg-spotify hover:text-white flex items-center justify-center transition-colors"><span class="material-icons text-lg">chevron_right</span></button>
          </div>
        </div>

        <!-- Tab: Top Songs -->
        <div id="tab-songs" class="tab-content hidden animate-fade-in">
          <header class="flex justify-between items-center sticky top-0 z-20 bg-[#121212]/90 backdrop-blur-xl px-4 md:px-6 py-4 mb-2 border-b border-white/5 shadow-lg transition-all">
            <h2 class="text-xl md:text-2xl font-bold">Top Songs</h2>
            <div class="relative">
              <select id="top-songs-interval" class="bg-black/40 text-white text-xs md:text-sm rounded-lg px-3 py-1.5 pr-8 focus:outline-none focus:ring-1 focus:ring-spotify cursor-pointer hover:bg-white/10 transition-colors border border-white/10">
                <option value="overall">All Time</option>
                <option value="7day">7 Days</option>
                <option value="1month" selected>1 Month</option>
                <option value="12month">1 Year</option>
              </select>
              <span class="material-icons absolute right-2 top-1.5 text-sm pointer-events-none text-gray-400">expand_more</span>
            </div>
          </header>
          <ul id="top-songs-list" class="space-y-2 px-4 md:px-6 pt-2">
            <li class="text-gray-500 animate-pulse text-sm">Loading songs...</li>
          </ul>
          <div class="flex justify-center md:justify-end items-center gap-4 mt-6 pt-4 border-t border-white/10 pb-6 px-4 md:px-6">
            <button id="top-songs-prev" class="w-8 h-8 rounded-full bg-white/5 hover:bg-spotify hover:text-white flex items-center justify-center transition-colors"><span class="material-icons text-lg">chevron_left</span></button>
            <span id="top-songs-page-number" class="text-sm font-mono text-gray-400">1</span>
            <button id="top-songs-next" class="w-8 h-8 rounded-full bg-white/5 hover:bg-spotify hover:text-white flex items-center justify-center transition-colors"><span class="material-icons text-lg">chevron_right</span></button>
          </div>
        </div>

      </div>
    </div>
  </div>

  <script>
    // --- CONFIGURATION ---
    const API_KEY = 'b25b959554ed76058ac220b7b2e0a026'; 
    const USERNAME = 'Isaiart';
    
    let currentTrack = null;
    let progressInterval;
    
    // Pagination state
    let topSongsPage = 1, topArtistsPage = 1, topAlbumsPage = 1;
    
    // --- API HELPER ---
    async function fetchLastfmData(method, params = {}) {
      const queryParams = new URLSearchParams({
        method,
        user: USERNAME,
        api_key: API_KEY,
        format: 'json',
        ...params
      });
      const url = `https://ws.audioscrobbler.com/2.0/?${queryParams}`;
      try {
        const response = await fetch(url);
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        return await response.json();
      } catch (error) {
        console.error(`Error fetching ${method}:`, error);
        return null;
      }
    }
    
    // --- UTILS ---
    function getAlbumArtUrl(images, size = 'extralarge') {
      if (!images || !Array.isArray(images)) return 'https://via.placeholder.com/300?text=No+Image';
      const image = images.find(img => img.size === size);
      if (image && image['#text']) {
        return image['#text'];
      }
      const largest = images[images.length - 1];
      if (largest && largest['#text']) return largest['#text'];
      return 'https://via.placeholder.com/300?text=No+Image';
    }
    
    function setBackgroundImage(url) {
      const bg = document.getElementById('bg-image');
      if(url && !url.includes('placeholder')) {
        bg.style.backgroundImage = `url(${url})`;
      } else {
        bg.style.backgroundImage = 'none';
        bg.style.backgroundColor = '#121212';
      }
    }
    
    function formatPlayTime(timestamp) {
      if (!timestamp) return 'Unknown';
      const now = new Date();
      const playedAt = new Date(timestamp * 1000);
      const diff = now - playedAt;
      const minutes = Math.floor(diff / 60000);
      if (minutes < 1) return 'Just now';
      if (minutes === 1) return '1 min ago';
      if (minutes < 60) return `${minutes} mins ago`;
      const hours = Math.floor(minutes / 60);
      if (hours === 1) return '1 hr ago';
      if (hours < 24) return `${hours} hrs ago`;
      const days = Math.floor(hours / 24);
      if (days === 1) return '1 day ago';
      return `${days} days ago`;
    }
    
    // --- UI UPDATES ---

    function updateNowPlaying(track) {
      const albumArtUrl = getAlbumArtUrl(track.image, 'extralarge');
      const imgElement = document.getElementById('album-art');
      
      if (imgElement.src !== albumArtUrl) {
        imgElement.src = albumArtUrl;
        setBackgroundImage(albumArtUrl);
      }
      
      document.getElementById('track-title').textContent = track.name;
      document.getElementById('track-artist').textContent = track.artist['#text'];
    }
    
    function createTrackListItem(track, extraInfo = '', isNowPlaying = false) {
      const albumArtUrl = getAlbumArtUrl(track.image, 'medium');
      const playTime = isNowPlaying 
        ? '<span class="text-spotify font-bold animate-pulse flex items-center gap-1"><span class="material-icons text-sm">equalizer</span> Now Playing</span>' 
        : (track.date ? formatPlayTime(track.date.uts) : '');
      
      return `
        <li class="group flex items-center p-2 md:p-3 rounded-xl hover:bg-white/10 transition-all duration-300 cursor-default border border-transparent hover:border-white/5">
          <img src="${albumArtUrl}" alt="Art" class="w-10 h-10 md:w-12 md:h-12 rounded-lg object-cover shadow-md mr-3 md:mr-4 group-hover:scale-105 transition-transform bg-gray-800">
          <div class="flex-1 min-w-0">
            <div class="font-semibold text-white truncate text-sm md:text-base">${track.name}</div>
            <div class="text-xs md:text-sm text-gray-400 truncate group-hover:text-gray-300">${track.artist['#text'] || track.artist.name}</div>
          </div>
          <div class="text-[10px] md:text-xs text-gray-500 font-medium ml-2 text-right whitespace-nowrap">
            ${extraInfo ? `<span class="block text-gray-400">${extraInfo}</span>` : ''}
            ${playTime}
          </div>
        </li>
      `;
    }
    
    function createArtistListItem(artist, rank) {
      const imageUrl = artist.image ? getAlbumArtUrl(artist.image, 'medium') : 'https://via.placeholder.com/64?text=Artist';
      return `
        <li class="group flex items-center p-2 md:p-3 rounded-xl hover:bg-white/10 transition-all duration-300 cursor-default border border-transparent hover:border-white/5">
          <div class="w-6 md:w-8 text-center text-gray-500 font-bold mr-2 text-xs md:text-sm">#${rank}</div>
          <div class="flex-1 min-w-0">
            <div class="font-bold text-white truncate text-sm md:text-base">${artist.name}</div>
            <div class="text-xs text-spotify font-medium">${parseInt(artist.playcount).toLocaleString()} plays</div>
          </div>
          <a href="${artist.url}" target="_blank" class="opacity-0 group-hover:opacity-100 transition-opacity text-gray-400 hover:text-white">
            <span class="material-icons text-base md:text-lg">open_in_new</span>
          </a>
        </li>
      `;
    }
    
    function createAlbumListItem(album, rank) {
      const albumArtUrl = album.image ? getAlbumArtUrl(album.image, 'medium') : 'https://via.placeholder.com/64?text=Album';
      return `
        <li class="group flex items-center p-2 md:p-3 rounded-xl hover:bg-white/10 transition-all duration-300 cursor-default border border-transparent hover:border-white/5">
          <div class="w-6 text-center text-gray-500 font-bold mr-2 text-xs md:text-sm">#${rank}</div>
          <img src="${albumArtUrl}" alt="Art" class="w-10 h-10 md:w-12 md:h-12 rounded-lg object-cover shadow-md mr-3 md:mr-4 group-hover:scale-105 transition-transform bg-gray-800">
          <div class="flex-1 min-w-0">
            <div class="font-semibold text-white truncate text-sm md:text-base">${album.name}</div>
            <div class="text-xs text-gray-400 truncate">${album.artist.name}</div>
          </div>
          <div class="text-[10px] md:text-xs text-gray-500 font-medium ml-2">
            ${parseInt(album.playcount).toLocaleString()} plays
          </div>
        </li>
      `;
    }
    
    function startProgressBar() {
      const progress = document.querySelector('.progress');
      let width = 0;
      clearInterval(progressInterval);
      progress.style.width = '0%';
      progressInterval = setInterval(() => {
        if (width >= 100) {
            width = 0; 
        } else {
          width += 0.2;
          progress.style.width = width + '%';
        }
      }, 200); 
    }
    
    // --- DATA FETCHING ---
    async function displayNowPlaying() {
      const data = await fetchLastfmData('user.getrecenttracks', { limit: 1 });
      if (data && data.recenttracks && data.recenttracks.track && data.recenttracks.track[0]) {
        const track = data.recenttracks.track[0];
        if (!currentTrack || track.name !== currentTrack.name) {
          currentTrack = track;
          updateNowPlaying(track);
          startProgressBar();
        }
      }
    }
    
    async function displayRecentTracks() {
      const data = await fetchLastfmData('user.getrecenttracks', { limit: 20 });
      const list = document.getElementById('recent-tracks-list');
      if (data && data.recenttracks && data.recenttracks.track) {
        const tracks = data.recenttracks.track;
        list.innerHTML = tracks.map(track => {
            const isNowPlaying = track['@attr'] && track['@attr'].nowplaying === 'true';
            return createTrackListItem(track, '', isNowPlaying);
        }).join('');
      } else {
        list.innerHTML = '<li class="p-4 text-center text-gray-500 text-sm">Could not load tracks. Check API Key.</li>';
      }
    }
    
    async function displayTopSongs() {
      const interval = document.getElementById('top-songs-interval').value;
      const data = await fetchLastfmData('user.gettoptracks', { period: interval, limit: 10, page: topSongsPage });
      const list = document.getElementById('top-songs-list');
      if (data && data.toptracks && data.toptracks.track) {
        list.innerHTML = data.toptracks.track.map(track => 
            createTrackListItem(track, `${parseInt(track.playcount).toLocaleString()} plays`)
        ).join('');
      } else {
        list.innerHTML = '<li class="p-4 text-center text-gray-500 text-sm">No data available.</li>';
      }
      document.getElementById('top-songs-page-number').textContent = topSongsPage;
    }
    
    async function displayTopArtists() {
      const interval = document.getElementById('top-artists-interval').value;
      const data = await fetchLastfmData('user.gettopartists', { period: interval, limit: 10, page: topArtistsPage });
      const list = document.getElementById('top-artists-list');
      if (data && data.topartists && data.topartists.artist) {
        list.innerHTML = data.topartists.artist.map((artist, index) => 
            createArtistListItem(artist, (topArtistsPage - 1) * 10 + index + 1)
        ).join('');
      } else {
        list.innerHTML = '<li class="p-4 text-center text-gray-500 text-sm">No data available.</li>';
      }
      document.getElementById('top-artists-page-number').textContent = topArtistsPage;
    }
    
    async function displayTopAlbums() {
      const interval = document.getElementById('top-albums-interval').value;
      const data = await fetchLastfmData('user.gettopalbums', { period: interval, limit: 10, page: topAlbumsPage });
      const list = document.getElementById('top-albums-list');
      if (data && data.topalbums && data.topalbums.album) {
        list.innerHTML = data.topalbums.album.map((album, index) => 
            createAlbumListItem(album, (topAlbumsPage - 1) * 10 + index + 1)
        ).join('');
      } else {
        list.innerHTML = '<li class="p-4 text-center text-gray-500 text-sm">No data available.</li>';
      }
      document.getElementById('top-albums-page-number').textContent = topAlbumsPage;
    }
    
    function updatePage() {
      displayNowPlaying();
      const activeTab = document.querySelector('.tab-content.block');
      if (activeTab) {
        const activeTabId = activeTab.id;
        if (activeTabId === 'tab-recent') displayRecentTracks();
        else if (activeTabId === 'tab-albums') displayTopAlbums();
        else if (activeTabId === 'tab-artists') displayTopArtists();
        else if (activeTabId === 'tab-songs') displayTopSongs();
      }
    }
    
    // --- EVENT LISTENERS ---
    document.getElementById('top-songs-interval').addEventListener('change', () => { topSongsPage = 1; displayTopSongs(); });
    document.getElementById('top-artists-interval').addEventListener('change', () => { topArtistsPage = 1; displayTopArtists(); });
    document.getElementById('top-albums-interval').addEventListener('change', () => { topAlbumsPage = 1; displayTopAlbums(); });
    
    document.getElementById('top-songs-prev').addEventListener('click', () => { if(topSongsPage > 1) { topSongsPage--; displayTopSongs(); }});
    document.getElementById('top-songs-next').addEventListener('click', () => { topSongsPage++; displayTopSongs(); });
    
    document.getElementById('top-artists-prev').addEventListener('click', () => { if(topArtistsPage > 1) { topArtistsPage--; displayTopArtists(); }});
    document.getElementById('top-artists-next').addEventListener('click', () => { topArtistsPage++; displayTopArtists(); });
    
    document.getElementById('top-albums-prev').addEventListener('click', () => { if(topAlbumsPage > 1) { topAlbumsPage--; displayTopAlbums(); }});
    document.getElementById('top-albums-next').addEventListener('click', () => { topAlbumsPage++; displayTopAlbums(); });
    
    const tabs = {
      recent: document.getElementById('tab-recent'),
      albums: document.getElementById('tab-albums'),
      artists: document.getElementById('tab-artists'),
      songs: document.getElementById('tab-songs')
    };
    const tabButtons = {
      recent: document.getElementById('tab-recent-btn'),
      albums: document.getElementById('tab-albums-btn'),
      artists: document.getElementById('tab-artists-btn'),
      songs: document.getElementById('tab-songs-btn')
    };
    
    window.switchTab = function(tabName) {
      Object.values(tabs).forEach(tab => {
        tab.classList.remove('block', 'animate-fade-in');
        tab.classList.add('hidden');
      });
      Object.values(tabButtons).forEach(btn => {
        btn.classList.remove('active', 'bg-white/10', 'text-white', 'border-white/5');
        btn.classList.add('text-gray-400', 'border-transparent');
      });
      tabs[tabName].classList.remove('hidden');
      tabs[tabName].classList.add('block', 'animate-fade-in');
      tabButtons[tabName].classList.remove('text-gray-400', 'border-transparent');
      tabButtons[tabName].classList.add('active', 'bg-white/10', 'text-white', 'border-white/5');
      
      if(tabName === 'recent') displayRecentTracks();
      if(tabName === 'albums') displayTopAlbums();
      if(tabName === 'artists') displayTopArtists();
      if(tabName === 'songs') displayTopSongs();
    }
    
    // --- INIT ---
    displayNowPlaying();
    displayRecentTracks();
    setInterval(updatePage, 10000);
  </script>
</body>
</html>